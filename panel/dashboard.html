<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NEXCARD • Dashboard</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg0:#f7fbff; --bg1:#eef4ff;
      --card:rgba(255,255,255,.72);
      --border:rgba(6,26,45,.12);
      --text:#0b1b2a; --muted:#5b6672;
      --navy:#061A2D; --navy2:#0A2A4A; --navy3:#0F3B6A;
      --accent:#21A1FF;
      --shadow: 0 24px 70px rgba(0,0,0,.16);
      --shadow-soft: 0 12px 28px rgba(6,26,45,.12);
      --ease: cubic-bezier(.22,1,.36,1);
      --maxw: 74rem;
    }

    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family:'Open Sans',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 10% 10%, rgba(33,161,255,.18), transparent 55%),
        radial-gradient(900px 700px at 90% 30%, rgba(99,211,255,.14), transparent 55%),
        linear-gradient(135deg,var(--bg0) 0%, var(--bg1) 100%);
      overflow-x:hidden;
    }
    body::before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      background-image:
        linear-gradient(to right, rgba(6,26,45,.05) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(6,26,45,.05) 1px, transparent 1px);
      background-size: 44px 44px;
      mask-image: radial-gradient(circle at 30% 20%, rgba(0,0,0,.85), rgba(0,0,0,.12) 55%, transparent 72%);
      opacity:.35;
      z-index:0;
    }

    .bg-accent{position:fixed; inset:-20%; pointer-events:none; z-index:0; filter: blur(42px);}
    .bg-accent::before,.bg-accent::after{
      content:""; position:absolute;
      width:min(620px, 72vw); height:min(620px, 72vw);
      border-radius:999px;
      background: radial-gradient(circle at 30% 30%, rgba(33,161,255,.52), rgba(33,161,255,.05) 70%, transparent 72%);
      animation: floatBlob 10s var(--ease) infinite;
    }
    .bg-accent::before{top: 1%; left: 6%;}
    .bg-accent::after{
      bottom: -2%; right: 2%;
      background: radial-gradient(circle at 30% 30%, rgba(15,59,106,.58), rgba(15,59,106,.08) 70%, transparent 72%);
      animation-duration: 12s; animation-direction: reverse;
    }
    @keyframes floatBlob{
      0%{ transform: translate3d(0,0,0) scale(1); }
      40%{ transform: translate3d(30px, -25px, 0) scale(1.05); }
      70%{ transform: translate3d(-18px, 18px, 0) scale(.98); }
      100%{ transform: translate3d(0,0,0) scale(1); }
    }

    .page{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 22px;
      position:relative;
      z-index:2;
    }

    .window{
      width:100%;
      max-width: var(--maxw);
      background: rgba(255,255,255,.38);
      border: 1px solid rgba(255,255,255,.35);
      border-radius: 28px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      overflow:hidden;
      transform: translateY(10px);
      opacity:0;
      animation: in .7s var(--ease) forwards;
    }
    @keyframes in { to{ transform: translateY(0); opacity:1; } }

    .topbar{
      padding: 16px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      background:
        radial-gradient(900px 320px at 15% 0%, rgba(33,161,255,.25), transparent 55%),
        linear-gradient(135deg, var(--navy) 0%, var(--navy2) 55%, var(--navy3) 100%);
      border-bottom: 1px solid rgba(255,255,255,.10);
    }

    .brand{display:flex; align-items:center; gap:12px; color:white;}
    .mark{
      width:44px; height:44px; border-radius:16px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.22);
      box-shadow: 0 14px 40px rgba(0,0,0,.22);
      position:relative; overflow:hidden;
    }
    .mark::after{
      content:""; position:absolute; inset:-40%;
      background: conic-gradient(from 180deg, rgba(33,161,255,0), rgba(33,161,255,.35), rgba(255,255,255,0));
      animation: spinGlow 4.8s linear infinite; opacity:.8;
    }
    @keyframes spinGlow{ to{ transform: rotate(360deg); } }

    .brand h1{font-family:'Montserrat',system-ui,sans-serif; font-size:18px; letter-spacing:-.02em;}
    .who{color: rgba(255,255,255,.88); font-weight:700; font-size:12.5px; margin-top:6px;}

    .actions{display:flex; gap: 10px; align-items:center; flex-wrap:wrap;}
    .btn{
      height: 44px;
      border: none;
      border-radius: 14px;
      font-weight: 900;
      letter-spacing: .04em;
      cursor:pointer;
      padding: 0 14px;
      display:flex; align-items:center; justify-content:center; gap: 10px;
      transition: transform .18s var(--ease), box-shadow .18s var(--ease), filter .18s var(--ease);
      user-select:none; white-space:nowrap;
    }
    .btn-ghost{
      background: rgba(255,255,255,.18);
      border: 1px solid rgba(255,255,255,.22);
      color: rgba(255,255,255,.92);
    }
    .btn-ghost:hover{transform: translateY(-1px); box-shadow: 0 18px 44px rgba(0,0,0,.25)}
    .btn-danger{
      background: rgba(255,255,255,.90);
      border: 1px solid rgba(255,59,59,.28);
      color:#b42318;
    }
    .tag{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.20);
      background: rgba(255,255,255,.14);
      font-weight: 900;
      font-size: 12px;
      color: rgba(255,255,255,.92);
    }
    .dot{width:8px;height:8px;border-radius:99px;background:var(--accent); box-shadow: 0 0 0 4px rgba(33,161,255,.15)}

    .content{padding: 18px; display:grid; gap: 14px;}

    .kpis{display:grid; grid-template-columns: repeat(6, 1fr); gap: 12px;}
    @media (max-width: 1120px){ .kpis{grid-template-columns: repeat(3, 1fr);} }
    @media (max-width: 680px){ .kpis{grid-template-columns: repeat(2, 1fr);} }

    .kpi{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 22px;
      box-shadow: var(--shadow-soft);
      padding: 14px;
    }
    .kpi b{display:block; font-family:'Montserrat',system-ui,sans-serif; font-size: 20px; letter-spacing:-.02em;}
    .kpi span{color: var(--muted); font-weight: 800; font-size: 12px;}

    .grid{display:grid; gap: 14px; grid-template-columns: 1.25fr .75fr;}
    @media (max-width: 980px){ .grid{grid-template-columns: 1fr;} }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 22px;
      box-shadow: var(--shadow-soft);
      padding: 16px;
    }

    .row{display:flex; gap: 10px; align-items:center; flex-wrap:wrap; justify-content:space-between;}
    .title{font-family:'Montserrat',system-ui,sans-serif; font-weight: 800; font-size: 16px;}
    .muted{color: var(--muted); font-weight:800; font-size:12.5px; line-height:1.5}

    .in, .sel{
      height: 46px;
      padding: 0 14px;
      border: 1px solid rgba(6,26,45,.12);
      border-radius: 14px;
      font-size: 14px;
      font-weight: 650;
      background: rgba(255,255,255,.90);
      transition: transform .18s var(--ease), border-color .18s var(--ease), box-shadow .18s var(--ease);
    }
    .in{width:100%}
    .sel{min-width: 200px}
    .in:focus, .sel:focus{
      outline:none;
      border-color: rgba(33,161,255,.85);
      box-shadow: 0 0 0 4px rgba(33,161,255,.18), 0 14px 40px rgba(6,26,45,.12);
      transform: translateY(-1px);
      background: #fff;
    }

    .seg{
      display:flex; gap:8px;
      background: rgba(255,255,255,.58);
      border: 1px solid rgba(6,26,45,.12);
      border-radius: 16px;
      padding: 6px;
      box-shadow: var(--shadow-soft);
    }
    .seg button{
      height: 36px;
      border: none;
      border-radius: 12px;
      padding: 0 12px;
      cursor:pointer;
      font-weight: 900;
      background: transparent;
      color: var(--navy2);
    }
    .seg button.active{
      background:
        radial-gradient(160px 120px at 20% 10%, rgba(99,211,255,.35), transparent 55%),
        linear-gradient(135deg, rgba(6,26,45,.92) 0%, rgba(10,42,74,.92) 55%, rgba(15,59,106,.92) 100%);
      color: white;
      box-shadow: 0 12px 28px rgba(6,26,45,.18);
    }

    .tablewrap{
      overflow:auto;
      border-radius: 18px;
      border: 1px solid rgba(6,26,45,.10);
      background: rgba(255,255,255,.86);
    }
    table{
      width:100%;
      border-collapse: separate;
      border-spacing:0;
      min-width: 980px;
      font-size: 13.5px;
    }
    th, td{
      padding: 12px 12px;
      border-bottom: 1px solid rgba(6,26,45,.10);
      font-weight: 700;
      text-align:left;
      white-space:nowrap;
    }
    th{
      position: sticky; top: 0; z-index: 2;
      background: rgba(245,248,255,.95);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      font-weight: 900;
    }
    tr:hover td{background: rgba(33,161,255,.06);}

    .mini-btn{
      height: 34px;
      padding: 0 10px;
      border-radius: 12px;
      border: 1px solid rgba(6,26,45,.12);
      background: rgba(255,255,255,.72);
      font-weight: 900;
      cursor:pointer;
      margin-right: 6px;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .mini-danger{border-color: rgba(255,59,59,.25); color:#b42318;}
    .mini-primary{
      border-color: rgba(33,161,255,.25);
      color: var(--navy3);
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(6,26,45,.12);
      font-weight: 900;
      font-size: 12px;
    }
    .badge .b-dot{width:8px;height:8px;border-radius:99px}
    .b-nuevo{background: rgba(33,161,255,.10);}
    .b-nuevo .b-dot{background:#21A1FF}
    .b-contactado{background: rgba(16,185,129,.12);}
    .b-contactado .b-dot{background:#10b981}
    .b-cerrado{background: rgba(245,158,11,.12);}
    .b-cerrado .b-dot{background:#f59e0b}

    .cards{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }
    @media (max-width: 1120px){ .cards{grid-template-columns: repeat(2,1fr);} }
    @media (max-width: 720px){ .cards{grid-template-columns: 1fr;} }

    .lead{
      background: rgba(255,255,255,.78);
      border: 1px solid rgba(6,26,45,.12);
      border-radius: 20px;
      box-shadow: var(--shadow-soft);
      padding: 14px;
    }
    .lead h3{
      font-family:'Montserrat',system-ui,sans-serif;
      font-size: 15px;
      letter-spacing:-.01em;
      margin-bottom: 6px;
    }
    .lead .meta{
      color: var(--muted);
      font-weight: 800;
      font-size: 12.5px;
      line-height: 1.45;
      margin-top: 8px;
    }
    .lead .actions{
      margin-top: 10px;
      display:flex;
      gap: 8px;
      flex-wrap:wrap;
    }

    .pager{
      display:flex; align-items:center; justify-content:space-between;
      gap: 10px; margin-top: 12px; flex-wrap:wrap;
    }
    .pager .left, .pager .right{display:flex; align-items:center; gap:10px; flex-wrap:wrap;}
    .pager .pbtn{
      height: 40px; border-radius: 12px; padding: 0 12px;
      border: 1px solid rgba(6,26,45,.12);
      background: rgba(255,255,255,.72);
      font-weight: 900; cursor:pointer;
    }
    .pager .pbtn:disabled{opacity:.55; cursor:not-allowed}
    .pager .info{color:var(--muted); font-weight:800; font-size:12.5px}

    .toast{
      position:fixed; left:50%; bottom:18px;
      transform: translateX(-50%);
      background: rgba(11,27,42,.92);
      color:white;
      border-radius: 999px;
      padding: 10px 14px;
      font-weight: 900;
      display:none;
      z-index: 999;
    }

    /* Modal */
    .modal-backdrop{
      position:fixed; inset:0;
      background: rgba(0,0,0,.35);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      display:none;
      align-items:center;
      justify-content:center;
      z-index: 1200;
      padding: 18px;
    }
    .modal{
      width: min(720px, 96vw);
      background: rgba(255,255,255,.80);
      border: 1px solid rgba(255,255,255,.40);
      border-radius: 22px;
      box-shadow: var(--shadow);
      overflow:hidden;
      transform: translateY(10px);
      opacity:0;
      transition: all .18s var(--ease);
    }
    .modal-backdrop.show{display:flex;}
    .modal-backdrop.show .modal{transform: translateY(0); opacity:1;}
    .modal-header{
      padding: 14px 16px;
      background:
        radial-gradient(900px 320px at 15% 0%, rgba(33,161,255,.18), transparent 55%),
        linear-gradient(135deg, rgba(6,26,45,.92) 0%, rgba(10,42,74,.92) 55%, rgba(15,59,106,.92) 100%);
      color:white;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .modal-header b{font-family:'Montserrat',system-ui,sans-serif;}
    .modal-body{padding: 14px 16px;}
    .form-grid{display:grid; grid-template-columns: 1fr 1fr; gap: 12px;}
    @media (max-width: 760px){ .form-grid{grid-template-columns: 1fr;} }
    .fg label{
      display:block; font-size:12px; font-weight:900;
      color: rgba(11,27,42,.78);
      letter-spacing:.06em; text-transform:uppercase;
      margin-bottom:6px;
    }
    .fg input,.fg textarea{
      width:100%;
      border:1px solid rgba(6,26,45,.12);
      border-radius: 14px;
      padding: 10px 12px;
      font-weight: 700;
      background: rgba(255,255,255,.92);
      font-size: 14px;
    }
    .fg textarea{min-height: 96px; resize: vertical;}
    .modal-actions{
      padding: 12px 16px 16px;
      display:flex;
      gap: 10px;
      justify-content:flex-end;
      flex-wrap:wrap;
    }
    .btn-primary{
      color:white;
      background:
        radial-gradient(160px 120px at 20% 10%, rgba(99,211,255,.55), transparent 55%),
        linear-gradient(135deg, var(--navy) 0%, var(--navy2) 55%, var(--navy3) 100%);
      box-shadow: 0 18px 40px rgba(6,26,45,.22);
    }
    .btn-light{
      background: rgba(255,255,255,.72);
      border: 1px solid rgba(6,26,45,.12);
      color: var(--navy2);
      box-shadow: var(--shadow-soft);
    }
    .btn-small{height: 42px; padding: 0 12px; border-radius: 14px;}
    .spinner{
      width: 16px; height: 16px;
      border: 2px solid rgba(255,255,255,.85);
      border-top-color: transparent;
      border-radius: 999px;
      animation: spin .7s linear infinite;
    }
    @keyframes spin{ to{ transform: rotate(360deg); } }
  </style>
</head>

<body>
  <div class="bg-accent"></div>

  <div class="page">
    <div class="window">
      <div class="topbar">
        <div class="brand">
          <div class="mark" aria-hidden="true"></div>
          <div>
            <h1>NEXCARD • Dashboard</h1>
            <p class="who" id="who">Cargando sesión…</p>
          </div>
        </div>

        <div class="actions">
          <span class="tag"><span class="dot"></span> Empresa: <span id="empresaId">—</span></span>

          <div class="seg" role="tablist" aria-label="Vista">
            <button id="viewTableBtn" class="active" type="button">Tabla</button>
            <button id="viewCardsBtn" type="button">Tarjetas</button>
          </div>

          <button class="btn btn-ghost" id="openEmpresaBtn" type="button">Cambiar empresa</button>
          <button class="btn btn-ghost" id="refreshBtn" type="button">Refrescar</button>
          <button class="btn btn-danger" id="logoutBtn" type="button">Cerrar sesión</button>
        </div>
      </div>

      <div class="content">
        <div class="kpis">
          <div class="kpi"><b id="kpiTotal">—</b><span>Total</span></div>
          <div class="kpi"><b id="kpiHoy">—</b><span>Hoy</span></div>
          <div class="kpi"><b id="kpiSemana">—</b><span>7 días</span></div>
          <div class="kpi"><b id="kpiMes">—</b><span>30 días</span></div>
          <div class="kpi"><b id="kpiNuevos">—</b><span>Nuevos</span></div>
          <div class="kpi"><b id="kpiContactados">—</b><span>Contactados</span></div>
        </div>

        <div class="grid">
          <div class="card">
            <div class="row">
              <div>
                <div class="title">Contactos</div>
                <div class="muted">Vista moderna + estados • editar/borrar • exportar</div>
              </div>
              <input id="contactsSearch" class="in" style="max-width: 340px;" placeholder="Buscar…">
            </div>

            <div style="height:10px"></div>

            <div class="row">
              <select id="filterEstado" class="sel">
                <option value="">Estado: Todos</option>
                <option value="Nuevo">Nuevo</option>
                <option value="Contactado">Contactado</option>
                <option value="Cerrado">Cerrado</option>
              </select>

              <select id="filterVendedor" class="sel">
                <option value="">Vendedor: Todos</option>
              </select>

              <select id="filterInteres" class="sel">
                <option value="">Interés/Servicio: Todos</option>
              </select>

              <button class="btn btn-ghost" id="clearFiltersBtn" type="button" style="height:46px;">
                Limpiar filtros
              </button>

              <button class="btn btn-ghost" id="exportCsvBtn" type="button" style="height:46px;">
                Exportar CSV
              </button>
            </div>

            <div style="height:12px"></div>

            <!-- TABLE VIEW -->
            <div id="tableView">
              <div class="tablewrap">
                <table>
                  <thead><tr id="contactsHead"></tr></thead>
                  <tbody id="contactsBody"></tbody>
                </table>
              </div>

              <div class="pager">
                <div class="left">
                  <button class="pbtn" id="prevPageBtn" type="button">← Anterior</button>
                  <button class="pbtn" id="nextPageBtn" type="button">Siguiente →</button>
                  <span class="info" id="pageInfo">—</span>
                </div>
                <div class="right">
                  <span class="info" id="rowsInfo">—</span>
                </div>
              </div>
            </div>

            <!-- CARDS VIEW -->
            <div id="cardsView" style="display:none;">
              <div class="cards" id="cardsGrid"></div>

              <div class="pager">
                <div class="left">
                  <button class="pbtn" id="prevPageBtn2" type="button">← Anterior</button>
                  <button class="pbtn" id="nextPageBtn2" type="button">Siguiente →</button>
                  <span class="info" id="pageInfo2">—</span>
                </div>
                <div class="right">
                  <span class="info" id="rowsInfo2">—</span>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="title">Acciones</div>
            <div class="muted" style="margin-top:6px;">
              • Ver • Editar • Borrar<br>
              • Marcar como Contactado (1 click)<br>
              • Exportar CSV de filtros actuales
            </div>

            <div style="height:12px"></div>

            <button class="btn btn-ghost" id="copyDashboardLink" type="button" style="width:100%; height:46px;">
              Copiar link del dashboard
            </button>

            <div style="height:10px"></div>

            <a class="btn btn-ghost" href="login.html" style="width:100%; height:46px; text-decoration:none;">
              Volver a Login
            </a>

            <div style="height:14px"></div>

            <div class="muted">
              <b>Nota:</b> Para usar estados, agrega una columna <b>Estado</b> en tu Sheet.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modals -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Modal">
      <div class="modal-header">
        <b id="modalTitle">—</b>
        <button class="btn btn-ghost btn-small" id="modalCloseBtn" type="button">Cerrar</button>
      </div>
      <div class="modal-body" id="modalBody"></div>
      <div class="modal-actions" id="modalActions"></div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script src="dashboard.js"></script>
</body>
</html>
